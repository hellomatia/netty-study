# 이벤트 모델

[자바 네트워크 소녀 Netty](https://product.kyobobook.co.kr/detail/S000001057642)

## 이벤트 루프
통상적인 이벤트 기밙 애플리케이션의 이벤트를 처리하는 방법은 크게 두 가징이다. 

**1. 이벤트 리스너와 이벤트 처리 스레드에 기반한 방법**

- 대부분의 UI 처리 프레임워크가 사용한다.
- 이벤트 메서드를 대상 객체의 이벤트 리스너에 등록하고, 객체에 이벤트가 발생했을 때 이벤트 처리 스레드에서 등록된 메서드를 수행한다.


**2. 이벤트 큐에 이벤트를 등록하고 이벤트 루프가 이벤트 큐에 접근하여 처리하는 방법**

- 프레임워크의 구현이 복잡하지만 프레임워크의 사용자 입장에서는 더 간단하게 사용할 수 있다.

**이벤트 루프란?**
- 이벤트를 실행하기 위해 무한루프 스레드를 지칭한다.

이벤트 루프가 지원하는 스레드 종류에 따라 단일 스레드 이벤트 루프와 다중 스레드 이벤트 루프로 나뉜다.

그리고 이벤트 루프가 처리의 결과를 돌려주는 방식에 따라서 콜백 패턴과 퓨천 패턴으로 나뉜다. (네티에서는 이 두가지 모두 지원한다.)


### 단일 스레드와 다중 스레드 이벤트 루프

**단일 스레드 이벤트 루프**
- 이벤트를 처리하는 스레드가 하나인 상태를 말한다.
- 구현이 단순하고 예측 가능한 동작을 보장한다.
- 다중 코어 CPU를 효율적으로 활용하지 못한다.
- node.js와 같은 애플리케이션을 효율적으로 운영하려고 여러 개의 인스턴스를 실행하기도 한다.

**다중 스레드 이벤트 루프**
- 이벤트를 처리하는 스레드가 여러 개이다.
- 구현난이도고 복잡하다. 
- 여러 이벤트 루프 스레드가 이벤트 큐 하나에 접근하여 여러 스레드가 자원 하나를 공유할 때 발생하는 스레드 경합이 발생한다.
- CPU를 효율적으로 사용한다.
- 이벤트 발생 순서와 실행 순서가 일치 하지 않는다.
- 컨텍스트 스위칭 비용과 스레드 경합이라는 단점이 존재한다.

## 네티의 이벤트 루프

네티는 단일 스레드 이벤트 루프와 다중 스레드 이벤트 루프를 모두 사용할 수 있다.

다중 스레드 이벤트 루프는 이벤트의 발생 순서와 실행 순서가 일치하지 않는다.

하지만 네티는 이벤트 루프의 종류와 상관없이 이벤트 발생 순서에 따른 실행 순서를 보장한다.

**네티 이벤트 루프 특징**
- 네티의 이벤트는 채널에서 발생시킨다.
- 이벤트 루프 객체는 이벤트 큐를 가지고 있다.
- 네티의 채널은 하나의 이벤트 루프에 등록한다.

네티는 이벤트 큐를 공유하지 않고, 이벤트 루프 내부에 두어서 수행 순서 불일치의 원인을 제거하였다.

네티는 이벤트를 처리하기 위해 SingleThreadEventExecutor를 사용한다.

## 네티의 비동기 I/O 처리

네티의 퓨처 패턴은 어떻게 구현되어 있을까?

퓨처 패턴은 미래에 완료도리 작업을 등록하고 처리 결과를 확인하는 객체를 통해 작업의 완료를 확인하는 패턴이다.

퓨처 패턴은 메서드를 호출하는 즉시 퓨처 객체를 돌려준다. 

